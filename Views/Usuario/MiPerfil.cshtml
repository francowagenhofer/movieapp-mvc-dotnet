@model MiPerfilViewModel

@{
    string mensaje = ViewData["Mensaje"] as string ?? "";
}

<main class="flex-grow-1 d-flex align-items-center justify-content-center py-3">
    <div class="container">
        <div class="row justify-content-center">

            <div class="col-12 col-md-8 col-lg-6 col-xl-5">

                <div class="card app-auth-card app-profile-card p-4 rounded-3">

                    <form method="post" enctype="multipart/form-data">
                        
                        <!-- Encabezado con foto y datos principales -->
                        <div class="text-center mb-3 pb-3 border-bottom border-secondary border-opacity-10">
                            <div class="profile-img-container mb-2">
                                <img alt="Foto de perfil" id="profileImage" class="profile-avatar" src="@Model.ImagenUrlPerfil" />
                                <button type="button" class="profile-edit-btn" onclick="document.getElementById('ImagenPerfil').click()">
                                    <span class="material-symbols-outlined">edit</span>
                                </button>
                                <input type="file" asp-for="ImagenPerfil" accept="image/png,image/jpeg,image/webp" class="form-control d-none" onchange="previewImage(this)" id="ImagenPerfil" />
                            </div>
                            <h2 class="h5 fw-bold mb-1">@Model.Nombre @Model.Apellido</h2>
                            <p class="text-secondary mb-0">@Model.Email</p>
                        </div>

                        <!-- Campos del formulario en dos columnas -->
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label" asp-for="Nombre">Nombre</label>
                                <input asp-for="Nombre" class="form-control form-control-sm" placeholder="Sophia" />
                                <span asp-validation-for="Nombre" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" asp-for="Apellido">Apellido</label>
                                <input asp-for="Apellido" class="form-control form-control-sm" placeholder="Clark" />
                                <span asp-validation-for="Apellido" class="text-danger small"></span>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" asp-for="Email">Correo electrónico</label>
                                <input asp-for="Email" class="form-control form-control-sm" disabled placeholder="sophia.clark@email.com" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label" asp-for="PhoneNumber">Teléfono</label>
                                <input asp-for="PhoneNumber" class="form-control form-control-sm" placeholder="+54 9 11 1234-5678" />
                                <span asp-validation-for="PhoneNumber" class="text-danger small"></span>
                            </div>
                            
                            <div class="col-md-6">                     
                                <label class="form-label" asp-for="FechaNacimiento">Fecha de Nacimiento</label>
                                <input asp-for="FechaNacimiento" type="date" class="form-control form-control-sm" />
                                <span asp-validation-for="FechaNacimiento" class="text-danger small"></span>
                            </div>
                        </div>

                        <!-- Botones de acción -->
                        <div class="mt-4 pt-3 border-top border-secondary border-opacity-10">
                            <div class="d-flex gap-2 justify-content-center">
                                <button class="btn btn-outline-primary fw-semibold" type="submit">
                                    Guardar cambios
                                </button>
                                <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary fw-semibold">
                                    <span class="material-symbols-outlined" style="font-size: 16px; vertical-align: middle;">arrow_back</span>
                                    Volver
                                </a>
                            </div>
                        </div>
                    </form>

                    @if (!string.IsNullOrEmpty(mensaje))
                    {
                        <div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
                            @mensaje
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</main>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('profileImage').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>